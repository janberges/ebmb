compiler = gfortran
mode = optimize

ifeq ($(compiler), gfortran)
  ifeq ($(mode), validate)
    options = -std=f2003 -Wall -Wno-maybe-uninitialized -pedantic
  else ifeq ($(mode), optimize)
    options = -O3
  endif
  override options += -J modules
else ifeq ($(compiler), ifort)
  ifeq ($(mode), validate)
    options = -O0 -warn all
  else ifeq ($(mode), optimize)
    options = -O3
  endif
  override options += -module modules
endif

external_critical = -llapack -lblas

needless = .DS_Store ebmb.pyc manual/ebmb.aux manual/.ebmb.lb manual/ebmb.log manual/ebmb.out manual/ebmb.synctex.gz modules/*.mod ~temporary.dat

# generated by makemake.py:

programs = critical ebmb tc

.PHONY: all clean cleaner

all: $(programs)

clean:
	@rm -f $(needless) eliashberg/eigenvalue.o eliashberg/eigenvalue_cdos.o eliashberg/self_energy.o eliashberg/self_energy_cdos.o io/load.o io/store.o io/tell.o programs/critical.o programs/ebmb.o programs/tc.o real_axis/pade.o real_axis/real_axis.o universal/eigenvalues.o universal/formatting.o universal/global.o universal/tools.o

cleaner: clean
	@rm -f $(programs)

$(programs):
	@echo link $@
	@$(compiler) -o $@ $^ $(external) $(external_$@)

%.o: %.f90
	@echo compile $*
	@$(compiler) $(options) -c $< -o $@

critical: eliashberg/eigenvalue.o eliashberg/eigenvalue_cdos.o eliashberg/self_energy.o io/load.o programs/critical.o universal/eigenvalues.o universal/global.o universal/tools.o
ebmb: eliashberg/self_energy.o eliashberg/self_energy_cdos.o io/load.o io/store.o io/tell.o programs/ebmb.o real_axis/pade.o real_axis/real_axis.o universal/formatting.o universal/global.o universal/tools.o
tc: eliashberg/self_energy.o eliashberg/self_energy_cdos.o io/load.o programs/tc.o universal/formatting.o universal/global.o universal/tools.o

eliashberg/eigenvalue.o: eliashberg/self_energy.o universal/eigenvalues.o universal/global.o
eliashberg/eigenvalue_cdos.o: universal/eigenvalues.o universal/global.o
eliashberg/self_energy.o: universal/global.o universal/tools.o
eliashberg/self_energy_cdos.o: universal/global.o
io/load.o: universal/global.o universal/tools.o
io/store.o: universal/global.o
io/tell.o: universal/formatting.o universal/global.o
programs/critical.o: eliashberg/eigenvalue.o eliashberg/eigenvalue_cdos.o io/load.o universal/global.o
programs/ebmb.o: eliashberg/self_energy.o eliashberg/self_energy_cdos.o io/load.o io/store.o io/tell.o real_axis/real_axis.o universal/global.o
programs/tc.o: eliashberg/self_energy.o eliashberg/self_energy_cdos.o io/load.o universal/formatting.o universal/global.o
real_axis/pade.o: universal/global.o
real_axis/real_axis.o: real_axis/pade.o universal/global.o universal/tools.o
universal/eigenvalues.o: universal/global.o universal/tools.o
universal/formatting.o: universal/global.o
universal/tools.o: universal/global.o
